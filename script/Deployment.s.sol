// SPDX-License-Identifier: GPL-3.0
pragma solidity 0.8.19;

import "forge-std/Test.sol";
import "forge-std/Script.sol";

import "src/CRVStrategy.sol";
import "solady/utils/LibClone.sol";

import {IVault} from "script/utils/IVault.sol";
import {ILocker} from "src/interfaces/ILocker.sol";
import {IBooster} from "src/interfaces/IBooster.sol";
import {IStrategy} from "src/interfaces/IStrategy.sol";
import {ISDLiquidityGauge} from "src/interfaces/ISDLiquidityGauge.sol";
import {SafeTransferLib as SafeTransfer} from "solady/utils/SafeTransferLib.sol";

import {ICVXLocker, Optimizer} from "src/optimizer/Optimizer.sol";
import {IBaseRewardPool, ConvexImplementation} from "src/fallbacks/ConvexImplementation.sol";
import {IBooster, ConvexMinimalProxyFactory} from "src/fallbacks/ConvexMinimalProxyFactory.sol";

interface IOldStrategy is IStrategy {
    function multiGauges(address) external view returns (address);
}

contract Deployment is Script, Test {
    using FixedPointMathLib for uint256;

    address public constant DEPLOYER = 0x000755Fbe4A24d7478bfcFC1E561AfCE82d1ff62;
    address public constant GOVERNANCE = 0xF930EBBd05eF8b25B1797b9b2109DDC9B0d43063;

    //////////////////////////////////////////////////////
    /// --- CONVEX ADDRESSES
    //////////////////////////////////////////////////////

    address public constant BOOSTER = address(0xF403C135812408BFbE8713b5A23a04b3D48AAE31);
    address public constant REWARD_TOKEN = address(0xD533a949740bb3306d119CC777fa900bA034cd52);
    address public constant FALLBACK_REWARD_TOKEN = address(0x4e3FBD56CD56c3e72c1403e103b45Db9da5B9D2B);

    //////////////////////////////////////////////////////
    /// --- VOTER PROXY ADDRESSES
    //////////////////////////////////////////////////////

    address public constant SD_VOTER_PROXY = 0x52f541764E6e90eeBc5c21Ff570De0e2D63766B6;
    address public constant CONVEX_VOTER_PROXY = 0x989AEb4d175e16225E39E87d0D97A3360524AD80;

    //////////////////////////////////////////////////////
    /// --- CURVE ADDRESSES
    //////////////////////////////////////////////////////

    address public constant VE_CRV = 0x5f3b5DfEb7B28CDbD7FAba78963EE202a494e2A2;
    address public constant MINTER = 0xd061D61a4d941c39E5453435B6345Dc261C2fcE0;

    ILocker locker = ILocker(SD_VOTER_PROXY);

    CRVStrategy public strategy;
    CRVStrategy public stratImplementation;

    Optimizer public optimizer;
    ConvexMinimalProxyFactory public factory;

    /// @notice Implementation contract to clone.
    ConvexImplementation public implementation;

    /// @notice Convex Depositor.
    ConvexImplementation public proxy;

    // Reward distributors array
    address[] public gauges = [
        0x7ca5b0a2910B33e9759DC7dDB0413949071D7575,
        0xA90996896660DEcC6E997655E065b23788857849,
        0xB1F2cdeC61db658F091671F5f199635aEF202CAC,
        0x705350c4BcD35c9441419DdD5d2f097d7a55410F,
        0x4c18E409Dc8619bFb6a1cB56D114C3f592E0aE79,
        0xbFcF63294aD7105dEa65aA58F8AE5BE2D9d0952A,
        0xC5cfaDA84E902aD92DD40194f0883ad49639b023,
        0x90Bb609649E0451E5aD952683D64BD2d1f245840,
        0x3C0FFFF15EA30C35d7A85B85c0782D6c94e1d238,
        0x182B723a58739a9c974cFDB385ceaDb237453c28,
        0x6d10ed2cF043E6fcf51A0e7b4C2Af3Fa06695707,
        0x055be5DDB7A925BfEF3417FC157f53CA77cA7222,
        0xF5194c3325202F456c95c1Cf0cA36f8475C1949F,
        0x72E158d38dbd50A483501c24f792bDAAA3e7D55C,
        0x9B8519A9a00100720CCdC8a120fBeD319cA47a14,
        0xd4B22fEdcA85E684919955061fDf353b9d38389b,
        0x824F13f1a2F29cFEEa81154b46C0fc820677A637,
        0x9582C4ADACB3BCE56Fea3e590F05c3ca2fb9C477,
        0xDeFd8FdD20e0f34115C7018CCfb655796F6B2168,
        0xd8b712d29381748dB89c36BCa0138d7c75866ddF,
        0x903dA6213a5A12B61c821598154EfAd98C3B20E4,
        0x63d9f3aB7d0c528797A12a0684E50C397E9e79dC,
        0x05ca5c01629a8E5845f12ea3A03fF7331932233A,
        0x99fb76F75501039089AAC8f20f487bf84E51d76F,
        0x65CA7Dc5CB661fC58De57B1E1aF404649a27AD35,
        0x4Fd86Ce7Ecea88F7E0aA78DC12625996Fb3a04bC,
        0x25f0cE4E2F8dbA112D9b115710AC297F816087CD,
        0xC95bdf13A08A547E4dD9f29B00aB7fF08C5d093d,
        0x1E212e054d74ed136256fc5a5DDdB4867c6E003F,
        0x8Fa728F393588E8D8dD1ca397E9a710E53fA553a,
        0x66ec719045bBD62db5eBB11184c18237D3Cc2E62,
        0x7E1444BA99dcdFfE8fBdb42C02F0005D14f13BE1,
        0x1B3E14157ED33F60668f2103bCd5Db39a1573E5B,
        0x6070fBD4E608ee5391189E7205d70cc4A274c017,
        0x05255C5BD33672b9FEA4129C13274D1E6193312d,
        0x009aCD89535DAbC270C93F9b39D3232105Fef453,
        0x38039dD47636154273b287F74C432Cac83Da97e2,
        0xAB1927160EC7414C6Fa71763E2a9f3D107c126dd,
        0x02246583870b36Be0fEf2819E1d3A771d6C07546,
        0xb07d00e0eE9b1b2eb9f1B483924155Af7AF0c8Fa,
        0x784342E983E9283A7108F20FcA21995534b3fE65,
        0xE786Df7076AFeECC3faCD841ED4AD20d0F04CF19,
        0xdB7cbbb1d5D5124F86E92001C9dFDC068C05801D,
        0x60355587a8D4aa67c2E64060Ab36e566B9bCC000,
        0x1779AEB087C5BdBe48749ab03575f5f25D1DEeaF,
        0x36C66bC294fEf4e94B3e40A1801d0AB0085Fe96e,
        0xE1D520B1263D6Be5678568BD699c84F7f9086023,
        0x1Ba86c33509013c937344f6e231DA2E63ea45197,
        0x3A748A2F4765BDFB119Cb7143b884Db7594a68c3,
        0xb6d7C2bda5a907832d4556AE5f7bA800FF084C2a,
        0x6d3328F0333f6FB0B2FaC87cF5a0FFa7e77beB60,
        0x89664D561E79Ca22Fd2eA4076b3e5deF0b219C15,
        0x8dF6FdAe05C9405853dd4cF2809D5dc2b5E77b0C,
        0x663FC22e92f26C377Ddf3C859b560C4732ee639a,
        0x03fFC218C7A9306D21193565CbDc4378952faA8c,
        0x95d16646311fDe101Eb9F897fE06AC881B7Db802,
        0xd5d3efC90fFB38987005FdeA303B68306aA5C624,
        0x4fb13b55D6535584841dbBdb14EDC0258F7aC414,
        0xa9A9BC60fc80478059A83f516D5215185eeC2fc0,
        0xa0C08C0Aede65a0306F7dD042D2560dA174c91fC,
        0xCFc25170633581Bf896CB6CDeE170e3E3Aa59503,
        0xf6D7087D4Ae4dCf85956d743406E63cDA74D99AD,
        0x389Fc079a15354E9cbcE8258433CC0F85B755A42,
        0xda7F9DD286577cC338047B040c289463743a474e,
        0x740BA8aa0052E07b925908B380248cb03f3DE5cB,
        0xb8b9dfCB48614FA873ccEC72c79D728d39EC9a5c,
        0xf865FDd6a5F307F398a94Dc40687995Cfaa77BC9,
        0x4329c8F09725c0e3b6884C1daB1771bcE17934F9,
        0x9f57569EaA61d427dEEebac8D9546A745160391C,
        0xF9F46eF781b9C7B76e8B505226d5E0e0E7FE2f04,
        0x28216318D85b2D6d8c2cB38eed08001d9348803b,
        0xBE266d68Ce3dDFAb366Bb866F4353B6FC42BA43c,
        0xf74175aCe638E612a0a3B09E6bE89795ff48E06D,
        0xD5bE6A05B45aEd524730B6d1CC05F59b021f6c87,
        0xB3783f527B7704DeeD4993f7c1c779E426A04368,
        0x5980d25B4947594c26255C0BF301193ab64ba803,
        0xCf79921D99b99FEe3DcF1A4657fCDA95195B46d1,
        0xAd96E10123Fa34a01cf2314C42D75150849C9295,
        0x2932a86df44Fe8D2A706d8e9c5d51c24883423F5,
        0xa8Ea11465A1375BF42463C3B613dFC54248b9C7B,
        0x805Aef679B1379Ee1d24c52158E7F56098D199D9,
        0xdA0DD1798BE66E17d5aB1Dc476302b56689C2DB4,
        0x6a69FfD1353Fa129f7F9932BB68Fa7bE88F3888A,
        0x6D787113F23bED1D5e1530402B3f364D0A6e5Af3,
        0x37Efc3f05D659B30A83cf0B07522C9d08513Ca9d,
        0x0A13654e7846Fbbd6fBc9F409AA453739bBADb74,
        0x06f691180F643B35E3644a2296a4097E1f577d0d,
        0x7970489a543FB237ABab63d62524d8A5CE165B86,
        0xA6f106d5AcFc6f7AC5d4aB84c3D7A8DaE658345F,
        0xACc9F5CEDC631180a2aD4C945377930fCFCC782F,
        0x4767841D4CC3567A2a7a8f55e08b03a9dEb0bfD5,
        0x2B917214c5d6F057FBdaF9a3aAE201e9f484FdAE,
        0xC25836AD05F14B7161638eDC67FD9C65B19F0C5A,
        0xe5d5Aa1Bbe72F68dF42432813485cA1Fc998DE32,
        0xB81465Ac19B9a57158a79754bDaa91C60fDA91ff,
        0x5A8fa46ebb404494D718786e55c4E043337B10bF,
        0x98ff4EE7524c501F582C48b828277D2B42bbc894,
        0x9d4D981d8a9066f5db8532A5816543dE8819d4A8,
        0xF668E6D326945d499e5B35E7CD2E82aCFbcFE6f0,
        0xfB18127c1471131468a1AaD4785c19678e521D86,
        0xBdCA4F610e7101Cc172E2135ba025737B99AbD30,
        0x8c1DFF7B6c20240C31f4F5BdFbC09ec6fF788d7a,
        0xfb860600F1bE1f1c72A89B2eF5CAF345aff7D39d,
        0x06B30D5F2341C2FB3F6B48b109685997022Bd272,
        0x4B6911E1aE9519640d417AcE509B9928D2F8377B,
        0xd03BE91b1932715709e18021734fcB91BB431715,
        0x50161102a240b1456d770Dbb55c76d8dc2D160Aa,
        0x79F21BC30632cd40d2aF8134B469a0EB4C9574AA,
        0x4e6bB6B7447B7B2Aa268C16AB87F4Bb48BF57939,
        0x5c07440a172805d566Faf7eBAf16EF068aC05f43,
        0xfcAf4EC80a94a5409141Af16a1DcA950a6973a39,
        0x95f00391cB5EebCd190EB58728B4CE23DbFa6ac1,
        0x27cace18f661161661683bBA43933B2E6eB1741E,
        0xEEBC06d495c96E57542A6d829184A907A02ef602,
        0x298bf7b80a6343214634aF16EB41Bb5B9fC6A1F1,
        0xE6A9fd148Ad624a5A8700c6366e23E3cD308DFcB,
        0x96424E6b5eaafe0c3B36CA82068d574D44BE4e3c,
        0xF29FfF074f5cF755b55FbB3eb10A29203ac91EA2,
        0x85D44861D024CB7603Ba906F2Dc9569fC02083F6,
        0x26F7786de3E6D9Bd37Fcf47BE6F2bC455a21b74A,
        0x785dFF4aD2b6e55D150D335B46D567D854053dC8,
        0x0060E266c2AF65bfc4fd51b04c93d952DF805630,
        0x5fDdB41cF566F6305293B2c9ad0fAf70dEAF7992,
        0x7292AfC5d77F988c873ca18F73CD96636c4Ac145,
        0x688Eb2C49D352c9448049A2263CFcE63D0918d3e,
        0x60d3d7eBBC44Dc810A743703184f062d00e6dB7e,
        0x512a68DD5433563Bad526C8C2838c39deBc9a756,
        0x533B5AeE744647C20e33653F03676c471bb8e67B,
        0xcb7CEB005dce5743026cDDaD2364d74f594b95A4,
        0x4Fc86cd0F9b650280Fa783e3116258e0E0496A2c,
        0xFA49B2a5D9E77f6748bf05801aa22356D514137b,
        0xe39c817fe25Ac1A8Bd343A74037E3C90b09bEeEF,
        0x696d31431E543Ffb36BE77DF95B73bAb95828233,
        0xB3627140BEacb97f9CA52b34090352FdAfC77d72,
        0x8D867BEf70C6733ff25Cc0D1caa8aA6c38B24817,
        0xDe14d2B848a7a1373E155Cc4db9B649f4BE24296,
        0xFc58C946A2D541cfA29Ad8c16FC2994323e34458,
        0xEcAD6745058377744c09747b2715c0170B5699e5,
        0x4e227d29b33B77113F84bcC189a6F886755a1f24,
        0x9dC22Ca10BB8210C8788827204Da091eb6cA04a5,
        0x4E21418095d32d15c6e2B96A9910772613A50d50,
        0x71873000399dB5FDDcD8d953E0e6570a0cb4c50C,
        0x839d92046F1e62A51A2b5705ecaE41DF152545ec,
        0x8b87c8d75a620Df2271eD06B161de6cf811221b6,
        0x2712E14F1C4819f7aeC4ba21e321C3E4662cf6De,
        0xF184d80915Ba7d835D941BA70cDdf93DE36517ee,
        0x4426027fEeb7d958498766A792AFE595b64bbFa1,
        0xD491639539c7434F3a788f6C88e818e5d7a552e9,
        0xb901a92F2c385AfA0A019e8A307a59A570239ca4,
        0x2DD2b7E07dD433B758B98A3889a63cbF48ef0D99,
        0x0df268355a2d8c985dCE76EA0B2f8009BB98D757,
        0x5439Dda1cE6A4A5222dB85bB2cAf0AB32c815Be6,
        0x378e249F4F7007Bd90c2186240374D512B839770,
        0x8584d7F7bf9803d45e8df75Afe824f1Ae83C6256,
        0x20e783242415A589B7E533a46A24FDA240590a18,
        0xF42E2b73Ea79812a7c3E4bA8ed052c523765719f,
        0xA812C37122046ebff408C90Db8065E36F0586A36,
        0xA6762d10D6471F778C9c6Ce21A38245e9387915e,
        0x188a85362CC5e245A377294aa270C7758A203918,
        0xd32F4bE8f777Ac27c6AAd544457de6d4f17a1BFA,
        0x8771b3537e31774613F395566c6E43DEBFA6B54a,
        0x2B5a5e182768a18C70EDd265240578a72Ca475ae,
        0xeA7368019a686320927298Cda56E389a23a9bc63
    ];

    // Reward distributors array generated using the pools.json file.
    address[] rewardDistributors = [
        0x822Faec5aa8fA750C73F8247977FFC78314d0B8c,
        0x951a88f0F88996b8Cde4403164182b8Fc148Bd4B,
        0xd7732D66c53a5e6D9Bc4344DaC62C5df4b8E4373,
        0xF05c0614448EAB9EB2cB93B31Db8Ab54E4C8b9dB,
        0x971662e2106582582859149241c1FcfDE8D5DBf7,
        0xf99FD99711671268EE557fEd651EA45e34B2414f,
        0x4F3a2Ad919471ab67104f2e0a17D820096d9Be2A,
        0xc31b3a3dbD0c06b78FcD5D01Ac1a2b948787a502,
        0xA7Ae691A17CA71Ca24b2D21De117213c2b64A54b,
        0x087143dDEc7e00028AA0e446f486eAB8071b1f53,
        0x62995770946ea9B8A90f5AA242048a145Ed8f7A7,
        0x2B4D555840C3A124D64F1ADca9140831B55f4a9b,
        0xe2867CeDeBB7F8eA60f52c9B1e8A216Adbb2F2ab,
        0xfA51194E8eafc40523574A65C1e4606E1432408B,
        0x3794C7C69B9c761ede266A9e8B8bb0f6cdf4E3E5,
        0xd382e1D8045f45264e4A661eDA8Efb9396A58a79,
        0x0bDabcDc2d2d41789A8F225F66ADbdc0CbDF6641,
        0x0F351Da018B93538F52E7120a8Cd2B4339a8013F,
        0x4D69ad5F243571AA9628bd88ebfFA2C913427b0b,
        0x28766020a5A8D3325863Bf533459130DDb0c3657,
        0xba621b27F071E249713866d7D7D0A97B12D2fa9b,
        0xEf965bD7539B8B9AD16e3930c97113710b7ec369,
        0x5Be7285Fb9A355e1bA97546B1178Fe2c40118DF7,
        0x0aa086A48Fbe6D97D315e2a6B0Db3d526d4C63E5,
        0x46A3c9048204431eAc65433fC311c2BAe583494E,
        0xE77fab713DD210a62A7Bc4E40378EE5A235A2350,
        0xa81920e413ad03Bc2DE9B1eF6D024fb3e2C21E7B,
        0x24520cdD0A0Cd242e78C6C5133A4a6a235d5A783,
        0x9B85d6e87350c021616Ae3DA78b9B1335c68283A,
        0x4a1C13D3887AE6e7289c4e0Cd7Ed1a4d1A3e21AE,
        0xaC7606876CeC9C02dC2dFe057F4024165D7cd86F,
        0xa5342c2Cc0cA11B5923FDbcFa194CE55e77E0a53,
        0x91F63E26dB25328Ad451681CFf568f9024347340,
        0xBb54780a563686940057fEde5472F03089363d7c,
        0x96B5de061f4733E967E1B25569C77f5D034CAD13,
        0xc7B7dee725fDc0560DdA72dcC0F403cEfbF09F82,
        0x21F6fcE087FE0BD8f4f7F7bAF0690F9576D7479A,
        0xfe96Ceb1616c609d7ECdD15aB030b120831e6209,
        0x78f4f7025D5DD8ad754f21b23Ee1C0B77c371767,
        0x48b41FfA5d8410FAC0dD740f2660303c3483CFaA,
        0xAF2E13cC54E0691A65D09cF625DD10913E5D9A4C,
        0x520D7399c82958cB9F96828B40E0AD55F76D9EbF,
        0x8527b2201Df6bfd09855AE5b28475DcC4A33C4f8,
        0xC891a1BaCF802127874054e703b386346fE94b00,
        0xd730d12CDCE7B7bBae1980bf1f9D3451049F766B,
        0x8c2dA60858FB7003F94edbB97ac50aB880b40Ba7,
        0x3B51fC10715D4208cAF4291849f50bF442B8C3Cb,
        0x7866d0FcfEf177F8Af857F22be9e4246F4fceC65,
        0x1dF8f590812F92769E677DcBE79CE54f19A58732,
        0xfA2a590f0bF2227A18f02124e7EF91256F952688,
        0x704547A51395cC72332C6F83dF41D795755CFa1A,
        0xf6fb52B2624aD7d37e219e8c3503c248ec6d8C52,
        0x8C8c4bbA402A1E037075ED437BAC4c487230016b,
        0x531167aBE95375Ec212f2b5417EF05a9953410C1,
        0x1E3923A498de30ff8C5Ac8bfAb1De9AFa58fDE5d,
        0xA89B9c336764c9Ae5f64Bc19688601341974bc22,
        0x1c963C8d7ABbB0f3521510a849349135c61Da9A1,
        0x8fAC850769B6bbeEe28ae9B987C19e04999aA439,
        0xb10DE77F94AFd8080FB7b563ee0d6388291F07Fb,
        0xAf7315BD7Fe6e6950b217F185FDA60Ea1f72412A,
        0xBe77585F4159e674767Acf91284160E8C09b96D8,
        0x6Fb81473F546457a96E1A5475a1f0A1717C18873,
        0x4c43cAecB45496FA7A8f874813F86F1D873a6e8F,
        0x359EB1f29f22191bC5723050Be2feA02Cd9ba81e,
        0x1B31C86024145583Ff37024A6B9aa8581A5070De,
        0x8C52985e1E23B81a30c163BC3477ff8453494c22,
        0x6b578A102fb2899b2cfF2E4c5857F428d6353ce6,
        0xc9CB5e84ADFa9F32Ed183e15ef423Bce93B845a9,
        0x8672E5C9E724E593afF47549E3D47EEB9B750aB3,
        0x63f222079608EEc2DDC7a9acdCD9344a21428Ce7,
        0x8474ed9bAe897B476aA98b7f1595a93e5E4A99cD,
        0x1aA62A793423d49496078F6814320706d91094AC,
        0x227eB2769f5Cd06AB590532Ec03E4b69dA0FdD8f,
        0x54aA01Ed2a0533CD9E58799C0b32AC7e1554C4cf,
        0x2472f84B42a2a80003DF5d3EA03Aa40A45ae0BE8,
        0xDE1F1698cD6228892fEAD129b733100367564c40,
        0x6931Dab8E59146f9cdD72e5549A6e09Cd491C6d6,
        0xcBA53d97121Cc23E1506507a444cB42066bc0dC2,
        0x131Dc928F9Dad07F43CEfF269e1674b7eBbFcBB1,
        0x4b95F9f85857341cC2876c15C88091a04eE5Cb31,
        0xB3a33E69582623F650e54Cc1cf4e439473A28D26,
        0x6C43E4cf922D5448E4ee73f7267FE8e294740811,
        0x31539d93f3504571A5ec85510ae15289A3b299De,
        0xc4649B184dBd1A4448c4d529fFbD1AD130289678,
        0x5DA19B47CF94cbC859605c5525539BaB4844C74F,
        0x2E2E5655A07f750a28d2c1DB492c4F67E20F6630,
        0x4514564B00A007b93d0eBF455f7322254fCD5b93,
        0x05717c25BF7FA97b1feceb028A3e99Bd89bddDF8,
        0xbC349c9181cFef856bA847d72f818076c9aa311a,
        0xE0d086E44bd5BB88d3F381440D5345C1f2dcDaCa,
        0xCC6464757088d82a26Ae316F30072428B5a546BE,
        0x5A7Ae8fA0fAf7a20C4FEB63e4D13695826c0Eaf7,
        0xB089E46ded52B1171Ed54b8749314427199Ff50e,
        0xdc43073cF00E616e9F80B95991Fa7732a397E6Ae,
        0x5056c3f17e45bdF11e09b1EF82a949dD68159C0E,
        0xE2568D65EeD31E6772CEf183f537032efEb68c23,
        0x768d4Cf3439494b36bD3a8e9beCE6B1C12e599c8,
        0x9E40D7eB9A2b1BfaDa78017a16217bD960abAF5a,
        0xeaa54d06f60215B966Ea806625073D1D499B54e5,
        0xc0A63f4f3033a1f09804624f9666Fd214925FD06,
        0x62C6f1f58c0cc5915c9d414a470F06E137c3DbdB,
        0x3D8442399Eea4f9e3A41556f0484FC84D1EDf538,
        0x4a2797E36B66f642fCD21A102E891c222D16692A,
        0x83EB53801dDaC98eCaaA6Ee5Ed859F08b1f4D905,
        0x3ad29CaB4E297320e6757011fD0bD85f0E8aA401,
        0xDfFBb620BA3DaBa85536105E16a13cd989A705cF,
        0x0E4d110Ff0a43d895081B02A3E9Ec426Ff79118C,
        0x6655C64A607F6fc4CE4D94A40657f364436F9dF4,
        0x4875D5E7987C93431E6DB9DC53A136F46270F0Dc,
        0x6E65845aE23Df033446Ee61d1A3772DbFA0Fd15F,
        0xB41639Fc6c2A4e55b5eA8706EafAA404bCE8C4f7,
        0x1f1a798cBDf4E9d533CEB9386e0A19b8C3F99121,
        0xB5eFFc36c1231f6fBd54F4b37047a7382B66DD30,
        0xA7f6547EA82589D0d5E789BdFCc412E296D21582,
        0xE94aFF2Bd6A12DD16C21648Cae71D2B47E405a9C,
        0xF2455AeF6713Fe54496e9A4330363D32C0c57B43,
        0xc31f496aaE237599872ac78611b245Bfe70fB06e,
        0xdd571E39aa0DF0bf142f6b81CBA5923dDacf06a7,
        0x44b4e01c249e35B2803f947C5CcB9868C3421437,
        0xA9812ED1077938E88577be7A8eaf097b5337fF5b,
        0xfBd740a3B5c74b97506d87A66a809200f99d63EB,
        0x2A2E11aA2B7988Ae4B5D21048699e4a4905bFCBA,
        0x2C4D6ABc7F76f9bB77CDF4D729d754020dd8DDDD,
        0xC207647B344455272E1278120D7d9368603412a2,
        0x799b35467C53F388D0c41D5f4EFFf8bAd7b33e96,
        0x608E4105e49ce2562521e31936815e2E20dA6609,
        0x3A34c9bE0C5E19F39A9774b9E7e5eB4c7f763A61,
        0x82d69F18C66278D59507610274DbC070F30AB009,
        0xD3aF4A839e09Ad759b9ccF02Fa2dDA3197ebe7d3,
        0xeC0fc375B1fEB8218f93fA1519ca91668931f2F0,
        0xA4eeEB03e66E6BF5E37BEbA946754944C024DcDb,
        0x2A1645283a69A35B3CC44063d71ad3e6B9b7463b,
        0x3177A119733327Cc1fAd19104118a51EE7F83674,
        0x21d908322813a195164589068727E605202c422b,
        0x86F8d09EfD8ad2c85Fee831f2730d1766A39ec18,
        0x417987107C146B5596b02d2fEa261111143e9f9c,
        0x90D722865c4Bd91d98a78ba142ffFD3b29c13347,
        0xf95E265F70874a0261F8F4a59822451c86f65b68,
        0x915cCdA60B089f4dc8715d5acB58CEA9273D927F,
        0x081312d469377507c05B9AE89340EB6fCE8242e9,
        0xaEfaE2ADaF173F58c3cDc57F324Ce967991D76B0,
        0x69AB5EA1B86D1341269F012115Ac914a334A1Ae3,
        0x81EA1dEDA4Bf80Ef5DA97f1b5396be3e29887207,
        0xC23D76D68b998E029Cf8476C83853e77C69fd38D,
        0xB25c8b3329d05c67194747653ae19d349c39fCB3,
        0x9343EB26c0b5fC4d13362920eA6C194b5476d366,
        0x2251c4faAE5967053fB3bB916A3ef15c07CaE1dF,
        0x01b00C33567a12733581AC3929DD9029dEA07DF7,
        0xabce07411b46c1243BcF4657271Eb85Ee857Fb84,
        0x46fBC1BB799C1D71548f69Ad0603DCcDb52d8341,
        0x4dfC2Acd0Fd69a503DBb079CAa2aF62A2680B221,
        0xF184023BD59E3BC0aD515306DA0891D82A6ed3C0,
        0xa6aEEf4455376470ddB62299857b59eF7DD9384b,
        0x1F4a64B0866433F020d5b74527c29f066DB7c03C,
        0x9bbF31E99F30c38a5003952206C31EEa77540BeF,
        0xaA81e655e0611597c75142f4030121093EF2c12A,
        0xdD745CA371c965B8491677Aefa07AC1C04F3B278,
        0x3D92968C1cb89Dc769E75Ba7C0D9Cd65505e021E,
        0x27Ed381A396125a8E53Cc1eF2117B68fd0ABEc8a,
        0x0CCd6f6F7FbD09aC2BC3241a1A1c707a69A63b2a,
        0xA2eEabfD28468d1402Be2112613946C8A2f3FbDe,
        0x4Db01E7893A6193dD4923BD9EdcC40924b0e38CD,
        0x36341DEf45b1a153Bbd4e99BcB41722887e9eEcD
    ];

    function run() public {
        vm.startBroadcast(DEPLOYER);

        /// 1. Deploy the Strategy and Proxy.
        stratImplementation = new CRVStrategy(address(this), SD_VOTER_PROXY, VE_CRV, REWARD_TOKEN, MINTER);
        address _proxy = LibClone.deployERC1967(address(stratImplementation));
        strategy = CRVStrategy(payable(_proxy));

        /// 2. Initialize the Strategy.
        strategy.initialize(DEPLOYER);

        vm.stopBroadcast();

        /// 3. Set the strategy as `strategy` in the locker. This mean the depositor would not work anymore.
        /// TODO: This action requires multisig action. The locker governance is the old strategy.
        /// Now we have the old strategy as `governance` and the new strategy as `strategy`
        vm.broadcast(locker.governance());
        /// By being strategy, we can use the execute function.
        locker.setStrategy(payable(address(strategy)));

        vm.startBroadcast(DEPLOYER);

        /// 4. Deploy ConvexMinimalProxy Factory.
        implementation = new ConvexImplementation();
        factory = new ConvexMinimalProxyFactory(
            BOOSTER, address(strategy), REWARD_TOKEN, FALLBACK_REWARD_TOKEN, address(implementation)
        );

        /// 5. Deploy the Optimizer and set it in the strategy.
        optimizer = new Optimizer(address(strategy), address(factory));
        strategy.setOptimizer(address(optimizer));

        /// 5. Transfer the ownership of the new strategy to governance.
        /// It should be accepted after all the scripts are executed.
        strategy.transferGovernance(GOVERNANCE);

        vm.stopBroadcast();

        /// 6. For each pool:
        /// . Toggle the vault to the new strategy.
        /// . Set the reward distributor to the new strategy.
        require(rewardDistributors.length == gauges.length, "Invalid length");

        for (uint256 i = 0; i < rewardDistributors.length; i++) {
            IOldStrategy oldStrategy = IOldStrategy(locker.governance());
            require(oldStrategy.multiGauges(gauges[i]) == rewardDistributors[i], "Invalid distributor");

            address token = ILiquidityGauge(gauges[i]).lp_token();
            address vault = ILiquidityGauge(rewardDistributors[i]).staking_token();

            /// . Toggle the vault to the new strategy.
            vm.broadcast(DEPLOYER);
            strategy.toggleVault(vault);

            vm.broadcast(DEPLOYER);
            strategy.setGauge(token, gauges[i]);

            vm.broadcast(DEPLOYER);
            strategy.setRewardDistributor(gauges[i], rewardDistributors[i]);

            /// Last step is to migrate the funds from the old strategy to the new one.
            vm.broadcast(GOVERNANCE);
            IVault(vault).setCurveStrategy(address(strategy));
        }

        /// This are the steps to migrate from the strategy to the new.
        /// Next missing steps:
        /// - For each reward distributor, update all distributor for any extra tokens to the strategy.
        /// - Move set the new strategy as governance in the locker.
        /// - Set the new depositor as strategy in the locker.
    }
}
